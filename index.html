<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEGO AI Szkenner PRO</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: sans-serif; overflow: hidden; }
        #camera { width: 100vw; height: 100vh; object-fit: cover; }
        .info-panel { position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%); width: 80%; background: rgba(242, 207, 17, 0.9); color: #000; padding: 20px; border-radius: 15px; text-align: center; box-shadow: 0 5px 20px rgba(0,0,0,0.5); }
        .label { font-size: 22px; font-weight: bold; margin: 0; }
        .conf { font-size: 14px; margin-top: 5px; opacity: 0.7; }
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #121212; display: flex; align-items: center; justify-content: center; z-index: 10; }
    </style>
</head>
<body>

<div id="loader">üöÄ AI bet√∂lt√©se...</div>
<video id="camera" autoplay playsinline muted></video>

<div class="info-panel" id="ui" style="display: none;">
    <p class="label" id="part-name">Keres√©s...</p>
    <div class="conf" id="part-conf">0%</div>
</div>

<script>
    let model;
    // T√∂ltsd ki a list√°t a saj√°t alkatr√©szeiddel (ABC sorrendben, ahogy a mapp√°k voltak a Drive-on!)
    const LABELS = ["4121715", "4142865", "4211622", "4514553", "6056664"]; 

    async function start() {
        try {
            // Modell bet√∂lt√©se a GitHub-r√≥l
            model = await tf.loadLayersModel('./model.json');
            document.getElementById('loader').style.display = 'none';

            // Kamera ind√≠t√°sa
            const video = document.getElementById('camera');
            const stream = await navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: "environment" }, 
                audio: false 
            });
            video.srcObject = stream;

            detect();
        } catch (e) {
            document.getElementById('loader').innerText = "Hiba: " + e.message;
        }
    }

    async function detect() {
        const video = document.getElementById('camera');
        
        // K√©pfeldolgoz√°s az AI-nak
        const tensor = tf.tidy(() => {
            return tf.browser.fromPixels(video)
                .resizeNearestNeighbor([224, 224])
                .toFloat()
                .div(tf.scalar(255.0))
                .expandDims();
        });

        const prediction = await model.predict(tensor);
        const scores = await prediction.data();
        const maxScore = Math.max(...scores);
        const index = scores.indexOf(maxScore);

        // Megjelen√≠t√©s, ha 80% felett van a tal√°lat
        const ui = document.getElementById('ui');
        if (maxScore > 0.8) {
            ui.style.display = 'block';
            document.getElementById('part-name').innerText = "LEGO " + LABELS[index];
            document.getElementById('part-conf').innerText = "Biztons√°g: " + Math.round(maxScore * 100) + "%";
        } else {
            ui.style.display = 'none';
        }

        tf.dispose([tensor, prediction]);
        requestAnimationFrame(detect);
    }

    start();
</script>
</body>
</html>
